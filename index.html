<!doctype html>
<html onselectstart="return false;">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="Parking,Game"/>
<title>Carcassonne</title>
<script src="score.js?i=1"></script>
<script src="data.js?i=1"></script>
<script src="carc.js?i=1"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js"></script>
<script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
<style>
    body, button, span {
        font-size: 24px;
    }
    body,html {
        -webkit-user-select: none;
        user-select: none;
        position: fixed;
    }
    td {
        padding-top:5px;
    }
    button {
        padding:5px;
    }
    .score, .score span{
        font-size: 24px;
    }
    .noTitleStuff .ui-dialog-titlebar {
        display:none;
    }
    .dialog button {
        font-size: 24px;
    }
    #tableScore td {
        font-size: 20px;
        text-align:center;
        padding: 1px;
        min-width:10px;
    }
    .cssPlayerTd {
        background-repeat:no-repeat;
        background-position: center;
        background-size:20px 20px;
        padding: 0px;
        width: 24px;
        height: 24px;
    }
    .goodsImg {
        background-repeat:no-repeat;
        background-position: center;
        background-size:20px;
        padding: 0px;
        width: 24px;
        height: 24px;
    }
</style>
</head>
<body>
    <canvas id="canvas" width="770" height="700" style="margin:0px;float:left"></canvas>
    <table id="tbl">
        <tr><td>
            <button id="btnNext" onclick="javascript:next()" disabled="true">next</button><br/>
        </td></tr>
        <tr><td class="score">
            stack <span id="tilesLeft"></span><br/>
        </td></tr>
        <tr><td>
            <button onclick="javascript:restartOption()">restart</button>
        </td></tr>
        <tr><td>
            <button onclick="javascript:edit()">edit</button><br/>
        </td></tr>
        <tr><td>
            <button onclick="javascript:rotateBackup()">rotate</button><br/>
        </td></tr>
        <tr><td class="score">
            <table id="tableScore" border="1" style="border-collapse: collapse" cellpadding="0px">
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="goodsImg" style="background-image: url('res/wine.png');"></td>
                    <td class="goodsImg" style="background-image: url('res/grain.png');"></td>
                    <td class="goodsImg" style="background-image: url('res/cloth.png');"></td>
                </tr>
                <tr class="cssPlayer" id="scorebox0">
                    <td onclick="javascript:clickPlayer(0)" class="cssPlayerTd" style="background-image: url('res/blue.png');"></td>
                    <td id="score0"></td>
                    <td id="scorep0"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="cssPlayer" id="scorebox1">
                    <td onclick="javascript:clickPlayer(1)" class="cssPlayerTd" style="background-image: url('res/red.png');"></td>
                    <td id="score1"></td>
                    <td id="scorep1"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="cssPlayer" id="scorebox2">
                    <td onclick="javascript:clickPlayer(2)" class="cssPlayerTd" style="background-image: url('res/green.png');"></td>
                    <td id="score2"></td>
                    <td id="scorep2"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="cssPlayer" id="scorebox3">
                    <td onclick="javascript:clickPlayer(3)" class="cssPlayerTd" style="background-image: url('res/yellow.png');"></td>
                    <td id="score3"></td>
                    <td id="scorep3"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="cssPlayer" id="scorebox4">
                    <td onclick="javascript:clickPlayer(4)" class="cssPlayerTd" style="background-image: url('res/black.png');"></td>
                    <td id="score4"></td>
                    <td id="scorep4"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                <tr class="cssPlayer" id="scorebox5">
                    <td onclick="javascript:clickPlayer(5)" class="cssPlayerTd" style="background-image: url('res/pink.png');"></td>
                    <td id="score5"></td>
                    <td id="scorep5"></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </td></tr>
        <tr><td>
            <button id="btnPreviousGame" onclick="javascript:switchGame(-1)">&lt;&lt;</button>
            <button id="btnNextGame" onclick="javascript:switchGame(1)">&gt;&gt;</button>
        </td></tr>
        <tr><td>
            <button id="btnDelete" onclick="javascript:deleteTile()">delete</button>
        </td></tr>
        <tr><td>
            <button class="btn" onclick="javascript:copy()">copy</button>
        </td></tr>
    </table>
    <div id="dialogNumber" title="Choose Number" class="dialog">
        <p>Choose Number</p>
    </div>
    <div id="dialogMode" title="Choose Mode" class="dialog">
        <p>
            <label for="c1">Classic</label>
            <input type="checkbox" id="c1" name="gmode" value="classic" checked="checked">
        </p>
        <p>
            <label for="c2">Inns and Cathedrals</label>
            <input type="checkbox" id="c2" name="gmode" value="inn">
        </p>
        <p>
            <label for="c3">Traders & Builders</label>
            <input type="checkbox" id="c3" name="gmode" value="trader">
        </p>
        <p>
            <label for="c4">The River</label>
            <input type="checkbox" id="c4" name="gmode" value="river">
        </p>
        <p>
            <label for="c5">The River II</label>
            <input type="checkbox" id="c5" name="gmode" value="river2">
        </p>
        <p>
            <label for="c6">George</label>
            <input type="checkbox" id="c6" name="gmode" value="george">
        </p>
        <p style="display:none">
            <label for="c7">Test</label>
            <input type="checkbox" id="c7" name="gmode" value="test">
        </p>
    </div>
</body>
<script>
    var selectedMode = 'classic';
$(function() {
    $("input").checkboxradio();

    $("#dialogNumber").dialog({
        dialogClass: 'noTitleStuff',
        autoOpen: false,
        resizable: false,
        draggable: false,
        height: "auto",
        width: 400,
        modal: true,
        buttons: {
            "2 players": function() {
                $( this ).dialog( "close" );
                restartGame(2)
            },
            "3 players": function() {
                $( this ).dialog( "close" );
                restartGame(3)
            },
            "4 players": function() {
                $( this ).dialog( "close" );
                restartGame(4)
            },
            "5 players": function() {
                $( this ).dialog( "close" );
                restartGame(5)
            },
            "6 players": function() {
                $( this ).dialog( "close" );
                restartGame(6)
            },
            Cancel: function() {
                $( this ).dialog( "close" );
            }
        }
    });
    $("#dialogMode").dialog({
        dialogClass: 'noTitleStuff',
        autoOpen: false,
        resizable: false,
        draggable: false,
        height: "auto",
        width: 400,
        modal: true,
        buttons: {
            "Confirm": function() {
                $( this ).dialog( "close" );
                let modes = [];
                $("input:checkbox[name='gmode']:checked").each(function(){
                    modes.push($(this).val());
                });
                selectedMode = modes.join('|')
                $( "#dialogNumber" ).dialog("open");
            },
            Cancel: function() {
                $( this ).dialog( "close" );
            }
        }
    });
});

    function restartOption() {
        $( "#dialogMode" ).dialog("open");
    }

    init()

    function restartGame(num) {
        for(let i = 0;i < 20;i++) {
            restart(num, true, selectedMode)
            // try several times until the first tile is placable
            if(scores.solutions.length > 0) {
                return
            }
        }
    }

    function copy() {
        new ClipboardJS('.btn', {
            text: function() {
                let gameJson = localStorage.getItem("game"+gameId)
                return gameJson
            }
        });
    }
</script>
</html>
